# --
# AgentTicketActionCommon.dtl - provides common HTML form for several masks
# Copyright (C) 2001-2010 OTRS AG, http://otrs.org/
# --
# $Id: AgentTicketActionCommon.dtl,v 1.4 2010-07-02 04:35:10 mp Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

<!-- dtl:block:Properties -->
<script type="text/javascript">//<![CDATA[
function submit_compose() {
<!-- dtl:block:NoteJs -->
    // if RichText is enabled, update the hidden textarea now for the body content check to work correctly
    if (typeof RichTextUpdateLinkedField == 'function') {
        RichTextUpdateLinkedField();
    }

<!-- dtl:block:NoteJs -->
<!-- dtl:block:TicketFreeTextCheckJs -->
    if (document.compose.$Data{"TicketFreeTextField"}.value == "") {
        alert('$JSText{"A required field is:"} ' + document.compose.$Data{"TicketFreeKeyField"}.value + '!');
        document.compose.$Data{"TicketFreeTextField"}.focus();
        return false;
    }
<!-- dtl:block:TicketFreeTextCheckJs -->
<!-- dtl:block:TicketFreeTimeCheckJs -->
    if (document.compose.$Data{"TicketFreeTimeCheck"} && document.compose.$Data{"TicketFreeTimeCheck"}.checked == false) {
        alert('$JSText{"A required field is:"} $QData{"TicketFreeTimeKey"}!');
        document.compose.$Data{"TicketFreeTimeCheck"}.focus();
        return false;
    }
<!-- dtl:block:TicketFreeTimeCheckJs -->

    return true;
}
//]]></script>

<script type="text/javascript">//<![CDATA[
function SpellCheckSubmit() {
    document.spelling.Body.value = document.compose.Body.value;
    window.open('', 'spelling', 'toolbar=no,location=no,status=yes,scrollbars=yes,resizable=yes,width=700,height=550,left=100,top=100');
    document.spelling.submit()
}
//]]></script>

<!-- dtl:block:OwnerJs -->
<script type="text/javascript">//<![CDATA[
function change_selected(sel) {
    start_elements = (sel + 4);
    if (document.compose.elements[0].name == "$Config{"SessionName"}") {
        start_elements = start_elements + 1;
    }
    if (!document.compose.elements[start_elements].checked) {
        document.compose.elements[start_elements].checked = true;
    }
}
//]]></script>
<!-- dtl:block:OwnerJs -->

<form action="$Env{"CGIHandle"}" method="post" enctype="multipart/form-data" name="compose" id="Compose" class="Validate">
    <input type="hidden" name="Action" value="$Env{"Action"}"/>
    <input type="hidden" name="Subaction" value="Store"/>
    <input type="hidden" name="TicketID" value="$QData{"TicketID"}"/>
    <input type="hidden" name="Expand" id="Expand" value=""/>
    <input type="hidden" name="FormID" value="$QData{"FormID"}"/>

    <div class="WidgetPopup ARIARoleMain">
        <div class="Header">
            <h1>

<!-- dtl:block:HeaderAgentTicketFreeText -->
                $Text{"Change Free Text of Ticket"}
<!-- dtl:block:HeaderAgentTicketFreeText -->

<!-- dtl:block:HeaderAgentTicketOwner -->
                $Text{"Change Owner of Ticket"}
<!-- dtl:block:HeaderAgentTicketOwner -->

<!-- dtl:block:HeaderAgentTicketClose -->
                $Text{"Close Ticket"}
<!-- dtl:block:HeaderAgentTicketClose -->

<!-- dtl:block:HeaderAgentTicketNote -->
                $Text{"Add Note to Ticket"}
<!-- dtl:block:HeaderAgentTicketNote -->

<!-- dtl:block:HeaderAgentTicketPending -->
                $Text{"Set Pending"}
<!-- dtl:block:HeaderAgentTicketPending -->

<!-- dtl:block:HeaderAgentTicketPriority -->
                $Text{"Change Priority of Ticket"}
<!-- dtl:block:HeaderAgentTicketPriority -->

<!-- dtl:block:HeaderAgentTicketResponsible -->
                $Text{"Change Responsible of Ticket"}
<!-- dtl:block:HeaderAgentTicketResponsible -->

                : $Data{"TicketNumber"}
            </h1>

            <p>
                <a href="">$Text{"Cancel & close window"}</a>
            </p>

<!-- dtl:block:PropertiesLock -->
            <img border="0" src="$Config{"Frontend::ImagePath"}warning.png" alt="$Text{"Info"}" />: <p class="Error">$Text{"Ticket locked!"}</p>
            (<a href="$Env{"Baselink"}Action=AgentTicketLock;Subaction=Unlock;TicketID=$Data{"TicketID"}" onmouseover="window.status='$JSText{"Ticket unlock!"}'; return true;" onmouseout="window.status='';">$Text{"Ticket unlock!"}</a>)
<!-- dtl:block:PropertiesLock -->

        </div>
        <div class="Content">

            <div class="Header">
                <h2>$Text{"Options"}</h2>
            </div>

            <div class="Content">
                <fieldset class="TableLike">

<!-- dtl:block:Title -->
                    <label for="Title">$Text{"Title"}:</label>
                    <div class="Field">
                        <input type="text" id="Title" name="Title" value="$QData{"Title"}" class="W75pc Validate_Required $Data{"TitleInvalid"}" />
                        <div id="TitleError" class="TooltipErrorMessage" ><p>$Text{"Title is required."}</p></div>
                        <div id="TitleServerError" class="TooltipErrorMessage"><p>$Text{"Title is required."}</p></div>
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Title -->

<!-- dtl:block:Type -->
                    <label for="TypeID">$Text{"Type"}:</label>
                    <div class="Field">
                        $Data{"TypeStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Type -->

<!-- dtl:block:Service -->
                    <label for="ServiceID">$Text{"Service"}:</label>
                    <div class="Field">
                        $Data{"ServiceStrg"}
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
    Core.UI.RegisterEvent('change', $('#ServiceID'), function (Event) {
        var $Form = $('#Expand').closest('form')
        Core.Form.Validate.DisableValidation($Form);
        $Form.find('#Expand').val('3').end().submit();
        return false;
    });
//]]></script>
<!--dtl:js_on_document_complete-->
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Service -->

<!-- dtl:block:SLA -->
                    <label for="SLAID">$Text{"SLA"}:</label>
                    <div class="Field">
                        $Data{"SLAStrg"}
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
    Core.UI.RegisterEvent('change', $('#SLAID'), function (Event) {
        var $Form = $('#Expand').closest('form')
        Core.Form.Validate.DisableValidation($Form);
        $Form.find('#Expand').val('3').end().submit();
        return false;
    });
//]]></script>
<!--dtl:js_on_document_complete-->
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:SLA -->

<!-- dtl:block:Owner -->
                    <label for="NewOwnerID">$Text{"New Owner"}:</label>
                    <div class="Field">
                        <input type="radio" name="NewOwnerType" value="New" $QData{"NewOwnerType::New"}/>
                        $Data{"OwnerStrg"}
                        <div id="NewOwnerIDServerError" class="TooltipErrorMessage"><p>$Text{"Please set a new owner!"}</p></div>
                    </div>
                    <div class="Clear"></div>

                    <label for="OldOwnerID">$Text{"Previous Owner"}:</label>
                    <div class="Field">
                        <input type="radio" name="NewOwnerType" value="Old" $QData{"NewOwnerType::Old"}/>
                        $Data{"OldOwnerStrg"}
                        <div id="OldOwnerIDServerError" class="TooltipErrorMessage"><p>$Text{"Please set a new owner!"}</p></div>
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Owner -->

<!-- dtl:block:Responsible -->
                    <label for="NewResponsibleID">$Text{"Responsible"}:</label>
                    <div class="Field">
                        $Data{"ResponsibleStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Responsible -->

<!-- dtl:block:Note -->
<!-- dtl:block:InformAgent -->
                    <label for="InformUserID">$Text{"Inform Agent"}: ($Text{"Optional"})</label>
                    <div class="Field">
                        $Data{"OptionStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:InformAgent -->

<!-- dtl:block:InvolvedAgent -->
                    <label for="InvolvedUserID">$Text{"Inform involved Agents"}:</label>
                    <div class="Field">
                        $Data{"InvolvedAgentStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:InvolvedAgent -->

                    <label for="Subject">$Text{"Subject"}:</label>
                    <div class="Field">
                        <input type="text" id="Subject" name="Subject" value="$QData{"Subject"}" class="W75pc Validate_Required $Data{"SubjectInvalid"}"/>
                        <div id="SubjectError" class="TooltipErrorMessage"><p>$Text{"A message should have a subject!"}</p></div>
                        <div id="SubjectServerError" class="TooltipErrorMessage"><p>$Text{"A message should have a subject!"}</p></div>
                    </div>
                    <div class="Clear"></div>

                    <label>$Text{"Options"}:</label>
                    <div class="Field">

<!-- dtl:block:SpellCheck -->
                        <a href="" onclick="SpellCheckSubmit(); return false;" onmouseover="window.status='$JSText{"Spell Check"}'; return true;" onmouseout="window.status='';">
                            <img border="0" src="$Config{"Frontend::ImagePath"}spell.png" />
                            $Text{"Spell check"}
                        </a>
<!-- dtl:block:SpellCheck -->

                    </div>
                    <div class="Clear"></div>

                    <label for="RichText">$Text{"Text"}:</label>
                    <div class="Clear"></div>

<!-- dtl:block:RichText -->
$Include{"RichTextEditor"}
<!-- dtl:block:RichText -->

                    <textarea id="RichText" class="RichText Wrap_$Env{"BrowserWrap"} Validate_Required $Data{"BodyInvalid"}" name="Body" rows="15" cols="$Config{"Ticket::Frontend::TextAreaNote"}">$QData{"Body"}</textarea>
                    <div id="RichTextError" class="TooltipErrorMessage"><p>$Text{"A message should have a body!"}</p></div>
                    <div id="RichTextServerError" class="TooltipErrorMessage"><p>$Text{"A message should have a body!"}</p></div>
                    <div class="Clear"></div>

                    <label>$Text{"Attachment"}:</label>
                    <div class="Field">
                        <ul>
<!-- dtl:block:Attachment -->
                            <li>
                                $QData{"Filename"} ($QData{"Filesize"})
                                <button type="submit" name="AttachmentDelete$QData{"FileID"}" value="$Text{"Delete"}">$Text{"Delete"}</button>
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
    Core.UI.RegisterEvent('click', $('#AttachmentDelete$QData{"FileID"}'), function () {
        Core.Form.Validate.DisableValidation($('#AttachmentDelete$QData{"FileID"}').closest('form'));
    });
//]]></script>
<!--dtl:js_on_document_complete-->
                            </li>
<!-- dtl:block:Attachment -->
                            <li>
                                <input name="FileUpload" id="FileUpload" type="file" size="40"/>
                                <input type="hidden" id="AttachmentUpload" name="AttachmentUpload" value="0" />
                            </li>
                        </ul>
<!--dtl:js_on_document_complete-->
<script type="text/javascript">//<![CDATA[
    Core.UI.RegisterEvent('change', $('#FileUpload'), function (Event) {
        var $Form = $('#FileUpload').closest('form');
        Core.Form.Validate.DisableValidation($Form);
        $Form.find('#AttachmentUpload').val('1').end().submit();

    });
//]]></script>
<!--dtl:js_on_document_complete-->
                    </div>
                    <div class="Clear"></div>

<!-- dtl:block:ArticleType -->
                    <label for="ArticleTypeID">$Text{"Note type"}:</label>
                    <div class="Field">
                        $Data{"ArticleTypeStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:ArticleType -->
<!-- dtl:block:Note -->

<!-- dtl:block:State -->
                    <label for="NewStateID">$Text{"Next state"}:</label>
                    <div class="Field">
                        $Data{"StateStrg"}
                    </div>
                    <div class="Clear"></div>

<!-- dtl:block:StatePending -->
                    <label>$Text{"Pending date"}:</label>
                    <div class="Field">
                        $Data{"DateString"}
                        <span class="Error Small">$Text{"$Data{"Date invalid"}"}</span>
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:StatePending -->
<!-- dtl:block:State -->

<!-- dtl:block:Priority -->
                    <label>$Text{"Priority"}:</label>
                    <div class="Field">
                        $Data{"PriorityStrg"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:Priority -->

<!-- dtl:block:TicketFreeText -->
                    <label>$Data{"TicketFreeKeyField"} :</label>
                    <div class="Field">
                        $Data{"TicketFreeTextField"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:TicketFreeText -->

<!-- dtl:block:TicketFreeTime -->
                    <label>$Data{"TicketFreeTimeKey"} :</label>
                    <div class="Field">
                        $Data{"TicketFreeTime"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:TicketFreeTime -->

<!-- dtl:block:ArticleFreeText -->
                    <label>$Data{"ArticleFreeKeyField"} :</label>
                    <div class="Field">
                        $Data{"ArticleFreeKeyField"}
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:ArticleFreeText -->

<!-- dtl:block:TimeUnits -->
                    <label for="TimeUnits">$Text{"Time units"}$Text{"$Config{"Ticket::Frontend::TimeUnits"}"}:</label>
                    <div class="Field">
                        <input type="text" name="TimeUnits" id="TimeUnits" value="$QData{"TimeUnits"}" class="Validate_TimeUnits $QData{"TimeUnitsRequired"}"/>
                        <div id="TimeUnitsError" class="TooltipErrorMessage"><p>$Text{"Invalid time!"}</p></div>
                    </div>
                    <div class="Clear"></div>
<!-- dtl:block:TimeUnits -->

                </fieldset>
            </div>
        </div>
        <div class="Footer">
            <button class="Primary" id="submitRichText" accesskey="g" type="submit" value="$Text{"Submit"}"">$Text{"Submit"}</button>
        </div>
    </div>
</form>

# invisible form
<form action="$Env{"CGIHandle"}" method="post" name="spelling" target="spelling">
    <input type="hidden" name="Action" value="AgentSpelling"/>
    <input type="hidden" name="Body" value=""/>
    <input type="hidden" name="spell_lang" value=""/>
</form>

<div id="UIElementPool">
    <div class="Dialog">
        <div class="Header"><span class="LeftCorner"></span><span><a class="Close" title="Close" href="#"></a></span></div>
        <div class="Content"></div>
        <div class="Footer"><span class="LeftCorner"></span><span></span></div>
    </div>
</div>
<!-- dtl:block:Properties -->
