<?xml version="1.0" encoding="utf-8" ?>
<database Name="otrs">

<!-- Drop unneeded fields in the ticket table -->
<TableAlter Name="ticket">
    <ColumnDrop Name="group_read"/>
    <ColumnDrop Name="group_write"/>
    <ColumnDrop Name="other_read"/>
    <ColumnDrop Name="other_write"/>
    <IndexDrop Name="ticket_answered"/>
    <ColumnDrop Name="ticket_answered"/>
</TableAlter>

<!-- Drop unneeded indices in the article_flags table -->
<TableAlter Name="article_flag">
    <IndexDrop Name="article_flag_create_by"/>
    <IndexDrop Name="article_flag_article_id_article_key"/>
</TableAlter>

<!-- Drop unneeded field group_id from ticket table -->
<TableAlter Name="ticket">
    <!-- First drop index using it -->
    <IndexDrop Name="ticket_queue_view"/>

    <!-- Now drop column -->
    <ColumnDrop Name="group_id"/>

    <!-- Now recreate index without group_id column -->
    <IndexCreate Name="ticket_queue_view">
        <IndexColumn Name="ticket_state_id"/>
        <IndexColumn Name="ticket_lock_id"/>
    </IndexCreate>
</TableAlter>

<!--  Create new tables for Process Management -->
<TableCreate Name="pm_process">
    <Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="INTEGER"/>
    <!-- entity_id is a unique identifier independent from id -->
    <Column Name="entity_id" Required="true" Type="VARCHAR" Size="50"/>
    <Column Name="name" Required="true" Type="VARCHAR" Size="200"/>
    <Column Name="state_id" Required="true" Type="SMALLINT"/>
    <!-- layout stored as YAML -->
    <Column Name="layout" Type="LONGBLOB"/>
    <!-- config stored as YAML like in the web service configuration -->
    <Column Name="config" Type="LONGBLOB"/>
    <Column Name="create_time" Required="true" Type="DATE"/>
    <Column Name="create_by" Required="true" Type="INTEGER"/>
    <Column Name="change_time" Required="true" Type="DATE"/>
    <Column Name="change_by" Required="true" Type="INTEGER"/>
    <Unique Name="pm_process_entity_id">
        <UniqueColumn Name="entity_id"/>
    </Unique>
    <ForeignKey ForeignTable="users">
        <Reference Local="create_by" Foreign="id"/>
        <Reference Local="change_by" Foreign="id"/>
    </ForeignKey>
</TableCreate>

<TableCreate Name="pm_activity">
    <Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="INTEGER"/>
    <!-- entity_id is a unique identifier independent from id -->
    <Column Name="entity_id" Required="true" Type="VARCHAR" Size="50"/>
    <Column Name="name" Required="true" Type="VARCHAR" Size="200"/>
    <!-- config stored as YAML like in the web service configuration -->
    <Column Name="config" Type="LONGBLOB"/>
    <Column Name="create_time" Required="true" Type="DATE"/>
    <Column Name="create_by" Required="true" Type="INTEGER"/>
    <Column Name="change_time" Required="true" Type="DATE"/>
    <Column Name="change_by" Required="true" Type="INTEGER"/>
    <Unique Name="pm_activity_entity_id">
        <UniqueColumn Name="entity_id"/>
    </Unique>
    <ForeignKey ForeignTable="users">
        <Reference Local="create_by" Foreign="id"/>
        <Reference Local="change_by" Foreign="id"/>
    </ForeignKey>
</TableCreate>

</database>
